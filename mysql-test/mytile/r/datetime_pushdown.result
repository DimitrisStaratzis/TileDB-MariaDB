#
# The purpose of this test is to validate MyTile pushdown of datetime conditions
#
CREATE TABLE dt (
column1 datetime(6) dimension=1 tile_extent="10",
column2 BLOB
) ENGINE=mytile;
INSERT INTO dt VALUES ('2020-10-20 00:00:00.000000','aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=');
INSERT INTO dt VALUES ('2020-10-20 01:00:00.000000','dmFsdWUy');
INSERT INTO dt VALUES ('2020-10-20 02:00:00.000000','dmFsdWU');
SELECT * FROM dt;
column1	column2
2020-10-20 00:00:00.000000	aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
2020-10-20 01:00:00.000000	dmFsdWUy
2020-10-20 02:00:00.000000	dmFsdWU
EXPLAIN SELECT column1, column2 FROM dt WHERE column1 = '2020-10-20 02:00:00.000000';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	dt	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM dt WHERE column1 = '2020-10-20 02:00:00.000000';
column1	column2
2020-10-20 02:00:00.000000	dmFsdWU
EXPLAIN SELECT column2 FROM dt WHERE column1 IN ('2020-10-20 00:00:00.000000','2020-10-20 02:00:00.000000') ORDER BY column1 asc;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	dt	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition; Using temporary; Using filesort
SELECT column2 FROM dt WHERE column1 IN ('2020-10-20 00:00:00.000000','2020-10-20 02:00:00.000000') ORDER BY column1 asc;
column2
aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
dmFsdWU
SELECT * FROM dt WHERE column2 = 'dmFsdWU';
column1	column2
2020-10-20 02:00:00.000000	dmFsdWU
DROP TABLE dt;
CREATE TABLE ts (
column1 timestamp(3) dimension=1 tile_extent="10",
column2 VARCHAR(255)
) ENGINE=mytile;
INSERT INTO ts VALUES ('2020-10-20 00:00:00.123','first');
INSERT INTO ts VALUES ('2020-10-21 01:00:00.456','second');
INSERT INTO ts VALUES ('2020-10-22 02:00:00.789','third');
SELECT * FROM ts;
column1	column2
2020-10-20 00:00:00.123	first
2020-10-21 01:00:00.456	second
2020-10-22 02:00:00.789	third
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-20 00:00:00.123';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-20 00:00:00.123';
column1	column2
2020-10-20 00:00:00.123	first
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-20 00:00:00.1230';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-20 00:00:00.1230';
column1	column2
2020-10-20 00:00:00.123	first
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-21 01:00:00.456';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-21 01:00:00.456';
column1	column2
2020-10-21 01:00:00.456	second
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-21 01:00:00.45600';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-21 01:00:00.45600';
column1	column2
2020-10-21 01:00:00.456	second
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-22 02:00:00.789';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-22 02:00:00.789';
column1	column2
2020-10-22 02:00:00.789	third
EXPLAIN SELECT column1, column2 FROM ts WHERE column1 = '2020-10-22 02:00:00.789000';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT column1, column2 FROM ts WHERE column1 = '2020-10-22 02:00:00.789000';
column1	column2
2020-10-22 02:00:00.789	third
EXPLAIN SELECT column2 FROM ts WHERE column1 IN ('2020-10-20 00:00:00.123', '2020-10-22 02:00:00.789') ORDER BY column1 asc;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	ts	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition; Using filesort
SELECT column2 FROM ts WHERE column1 IN ('2020-10-20 00:00:00.123', '2020-10-22 02:00:00.789') ORDER BY column1 asc;
column2
first
third
DROP TABLE ts;
CREATE TABLE d (
column1 date dimension=1 tile_extent="10",
column2 int
) ENGINE=mytile;
INSERT INTO d VALUES ('1970-12-31',1970);
INSERT INTO d VALUES ('2000-06-11',2000);
INSERT INTO d VALUES ('2020-10-23',2020);
SELECT * from d;
column1	column2
1970-12-31	1970
2000-06-11	2000
2020-10-23	2020
EXPLAIN SELECT * FROM d WHERE column1 = '1970-12-31';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	d	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM d WHERE column1 = '1970-12-31';
column1	column2
1970-12-31	1970
EXPLAIN SELECT * FROM d WHERE column1 = '2000-06-11';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	d	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM d WHERE column1 = '2000-06-11';
column1	column2
2000-06-11	2000
EXPLAIN SELECT * FROM d WHERE column1 = '2020-10-23';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	d	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM d WHERE column1 = '2020-10-23';
column1	column2
2020-10-23	2020
EXPLAIN SELECT * from d WHERE column1 IN ('1970-12-31', '2000-06-11', '2020-10-23');
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	d	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * from d WHERE column1 IN ('1970-12-31', '2000-06-11', '2020-10-23');
column1	column2
1970-12-31	1970
2000-06-11	2000
2020-10-23	2020
DROP TABLE d;
CREATE TABLE y (
column1 year dimension=1 tile_extent="10",
column2 int
) ENGINE=mytile;
INSERT INTO y VALUES (1970,1970);
INSERT INTO y VALUES (2000,2000);
INSERT INTO y VALUES (2050,2050);
SELECT * from y;
column1	column2
1970	1970
2000	2000
2050	2050
EXPLAIN SELECT * FROM y WHERE column1 = 1970;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM y WHERE column1 = 1970;
column1	column2
1970	1970
EXPLAIN SELECT * FROM y WHERE column1 = 2000;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM y WHERE column1 = 2000;
column1	column2
2000	2000
EXPLAIN SELECT * FROM y WHERE column1 = 2050;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * FROM y WHERE column1 = 2050;
column1	column2
2050	2050
EXPLAIN SELECT * from y WHERE column1 IN (1970, 2000, 2050);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	y	ALL	NULL	NULL	NULL	NULL	2	Using where with pushed condition
SELECT * from y WHERE column1 IN (1970, 2000, 2050);
column1	column2
1970	1970
2000	2000
2050	2050
DROP TABLE y;
